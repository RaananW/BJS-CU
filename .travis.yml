sudo: required
dist: trusty

language: node_js
node_js:
- '6'

git:
  depth: 3

cache:
  directories:
    - Tools/Gulp/node_modules
    - Playground/node_modules
    - tests/unit/node_modules

install:
  - travis_retry npm install -g gulp
  - cd ./Tools/Gulp
  - travis_retry npm install

jobs:
  include:
    - stage: BabylonJS Build and test
      env: JOB=WhatsNewUpdate
      script: gulp tests-whatsnew
    - env: JOB=DocumentationCheck
      script: gulp typedoc-check
    - env: JOB=Build
      script: gulp typescript-all
    - env: JOB=Tests
      script:
        - "export DISPLAY=:99.0"
        - "sh -e /etc/init.d/xvfb start"
        - sleep 3 # give xvfb some time to start
        - set -e
        - gulp typescript-all
        - gulp typedoc-all
        - gulp tests-unit
        - travis_retry gulp tests-validation-virtualscreen
        - travis_retry gulp tests-validation-browserstack

notifications:
  slack:
    secure: U5Z8IyrnweEQjkuqilARavJlcBwvwAv/PAMCgJpNRA2winRxJBnd+2rc7mhlsTYNbhqj/wXU2DZa+RXhfmmE8WCr7DhQDv5UJL3mHKa8NouIivWTK6YkYfDiIoKuGONwNAzlF3Eq+U6AwLb1Wg8MSnxrb/+mafQ7VWVXB/O0wqg=
env:
  global:
  - secure: "cjCwRtvMvAK20ag6PufXDrW7+5R7d8kcKJduTkwurOEeOhDLCuoOnyZJUOyXT/mdBGhseQIv7QNNeBTqmmPCFjbQICr0+OLW7SfebDqSJM/MTfZfMHwrNR7wxALdCZLcQ28T3drowoUDdVMpZe6ErP8zriLJ8wMqkCLH7TML/AU="
  - secure: "aKd5xG+EU4eDzpURt4N2weTgAsfJrdCQzmxu7eu0ZO2HnpuqpjQQuA+A3GyxMjUZq2Zhazc1hvxHVYH9TTIwBKDXRyT1eHNFYvO22MtV0mRL3BJ7ox2JimPBqL246nKPuJsEuQtq75yzIQiAA5egXvPNJJJwEa76L/0qprnkTWw="
